server {
    listen 80;
    server_name 15.188.100.106;      # tu IP o dominio

    # ─────────── SPA estática ───────────
    root /usr/share/nginx/html;
    index index.html;
    client_max_body_size 100M;

    location / {
        try_files $uri $uri/ /index.html;
    }

    # ─────────── API (micro‑servicios) ───────────
    #
    # Cada prefijo apunta a su contenedor;
    # RECUERDA: **NO** hay bloque genérico /api/ que
    # redirija todo a Catalog.
    #
    location /api/auth/       { proxy_pass http://auth:8000;       include /etc/nginx/proxy_params; }
    location /api/items/      { proxy_pass http://catalog:8000;    include /etc/nginx/proxy_params; }
    location /api/categories/ { proxy_pass http://catalog:8000;    include /etc/nginx/proxy_params; }
    location /api/rentals/    { proxy_pass http://rentals:8000;    include /etc/nginx/proxy_params; }
    location /api/upload/     { proxy_pass http://upload:8000;     include /etc/nginx/proxy_params; }
    location /api/payments/   { proxy_pass http://payments:8000;   include /etc/nginx/proxy_params; }

    # ─────────── Ficheros subidos ───────────
    location /uploads/        { proxy_pass http://upload:8000;     include /etc/nginx/proxy_params; }

    # Fallback: si llega cualquier otra cosa a /api/, devuelve 404
    location /api/ { return 404; }
}
